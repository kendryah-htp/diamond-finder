<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Diamond Finderâ„¢ Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Jost:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:'Jost',sans-serif;background:#0f0a07;color:#f5e6c8;min-height:100vh}
  input,textarea,button,select{font-family:'Jost',sans-serif}
  .input{width:100%;padding:11px 14px;background:rgba(255,248,235,0.06);border:1px solid rgba(200,169,110,0.25);border-radius:10px;color:#f5e6c8;font-size:14px;outline:none;transition:border 0.2s}
  .input:focus{border-color:rgba(200,169,110,0.6)}
  .label{display:block;font-size:11px;color:rgba(200,169,110,0.6);letter-spacing:1px;text-transform:uppercase;margin-bottom:6px}
  .btn-gold{background:linear-gradient(135deg,#c8a96e,#a07840);border:none;color:#fff;border-radius:10px;padding:13px 24px;font-size:14px;font-weight:600;cursor:pointer;letter-spacing:.5px;transition:opacity 0.2s}
  .btn-gold:hover{opacity:.88}
  .btn-ghost{background:rgba(200,169,110,0.1);border:1px solid rgba(200,169,110,0.25);color:#c8a96e;border-radius:9px;padding:8px 18px;font-size:13px;cursor:pointer;transition:background 0.2s}
  .btn-ghost:hover{background:rgba(200,169,110,0.18)}
  #loading-screen{position:fixed;inset:0;background:#0f0a07;display:flex;align-items:center;justify-content:center;z-index:999;flex-direction:column;gap:16px}
  #login-screen{display:none;min-height:100vh;background:linear-gradient(135deg,#0f0a07,#1e1208,#0f0a07);align-items:center;justify-content:center}
  #dashboard{display:none;min-height:100vh;flex-direction:column}
  .card{background:rgba(255,248,235,0.04);border:1px solid rgba(200,169,110,0.12);border-radius:14px;padding:22px}
  @keyframes float{from{transform:translateY(0)}to{transform:translateY(-8px)}}
  @keyframes spin{to{transform:rotate(360deg)}}
  @keyframes fadein{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
  .fadein{animation:fadein 0.35s ease forwards}
  .tab-btn{width:100%;text-align:left;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-size:13px;margin-bottom:4px;font-family:'Jost',sans-serif;border-left:2px solid transparent;transition:all 0.2s;background:transparent;color:rgba(200,169,110,0.5)}
  .tab-btn.active{background:rgba(200,169,110,0.14);color:#c8a96e;border-left:2px solid #c8a96e}
  .tab-btn:hover:not(.active){background:rgba(200,169,110,0.07);color:rgba(200,169,110,0.75)}
  .tab-panel{display:none}.tab-panel.active{display:block;animation:fadein 0.3s ease}
  .save-status{font-size:12px;font-family:monospace;margin-left:12px;transition:opacity 0.3s}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:24px}
  @media(max-width:700px){.grid2{grid-template-columns:1fr}}
  input[type=range]{accent-color:#c8a96e;width:100%}
  input[type=color]{width:40px;height:36px;border-radius:8px;border:none;cursor:pointer;padding:0}
  input[type=checkbox]{accent-color:#c8a96e;width:16px;height:16px}
  pre{white-space:pre-wrap;word-break:break-all}
</style>
</head>
<body>

<!-- LOADING -->
<div id="loading-screen">
  <div style="font-size:48px">ğŸ’</div>
  <div style="color:#c8a96e;font-family:'Cormorant Garamond',Georgia,serif;font-size:18px;letter-spacing:2px">Loading Diamond Finderâ„¢</div>
  <div style="width:32px;height:32px;border:2px solid rgba(200,169,110,0.2);border-top-color:#c8a96e;border-radius:50%;animation:spin 0.8s linear infinite;margin-top:8px"></div>
</div>

<!-- LOGIN -->
<div id="login-screen" style="display:none">
  <div style="background:rgba(255,248,235,0.04);border:1px solid rgba(200,169,110,0.28);border-radius:20px;padding:48px 40px;width:380px;max-width:94vw;backdrop-filter:blur(12px);box-shadow:0 24px 80px rgba(0,0,0,0.6)">
    <div style="text-align:center;margin-bottom:32px">
      <div style="font-size:52px;margin-bottom:12px">ğŸ’</div>
      <div style="color:#c8a96e;font-family:'Cormorant Garamond',serif;font-size:24px;font-weight:700;letter-spacing:2px">Diamond Finderâ„¢</div>
      <div style="color:rgba(200,169,110,0.45);font-size:11px;margin-top:4px;letter-spacing:2px;text-transform:uppercase">Admin Portal</div>
    </div>
    <div style="margin-bottom:16px">
      <label class="label">Email</label>
      <input class="input" type="email" id="login-email" placeholder="your@email.com" onkeydown="if(event.key==='Enter')doLogin()"/>
    </div>
    <div style="margin-bottom:16px">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
        <label class="label" style="margin:0">Password</label>
        <span id="pw-hint" style="display:none;font-size:10px;color:#c8a96e;background:rgba(200,169,110,0.12);border:1px solid rgba(200,169,110,0.25);border-radius:6px;padding:2px 9px;font-style:italic">ğŸ’¡ check your onboarding doc</span>
      </div>
      <input class="input" type="password" id="login-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')doLogin()"/>
    </div>
    <div id="login-error" style="color:#e05252;font-size:13px;margin-bottom:10px;text-align:center;display:none"></div>
    <button class="btn-gold" style="width:100%;margin-top:4px" onclick="doLogin()">ACCESS ADMIN</button>
    <div style="margin-top:22px;padding-top:16px;border-top:1px solid rgba(200,169,110,0.12);text-align:center;color:rgba(200,169,110,0.35);font-size:11px">
      Supabase powered Â· Syncs across all devices
    </div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard" style="display:none">
  <!-- NAV -->
  <div style="display:flex;align-items:center;justify-content:space-between;padding:15px 28px;border-bottom:1px solid rgba(200,169,110,0.13);background:rgba(10,6,3,0.85);backdrop-filter:blur(12px);position:sticky;top:0;z-index:100">
    <div style="display:flex;align-items:center;gap:12px">
      <span style="font-size:22px">ğŸ’</span>
      <div>
        <div style="font-size:15px;font-weight:700;color:#c8a96e;letter-spacing:1px;font-family:'Cormorant Garamond',serif">Diamond Finderâ„¢</div>
        <div style="font-size:9px;color:rgba(200,169,110,0.35);letter-spacing:2px;text-transform:uppercase">Admin Portal</div>
      </div>
    </div>
    <div style="display:flex;align-items:center;gap:14px">
      <span class="save-status" id="save-status" style="opacity:0"></span>
      <span style="font-size:11px;color:rgba(200,169,110,0.4)" id="nav-email"></span>
      <button class="btn-ghost" onclick="doLogout()">Logout</button>
    </div>
  </div>

  <div style="display:flex;min-height:calc(100vh - 60px)">
    <!-- SIDEBAR -->
    <div style="width:176px;flex-shrink:0;padding:20px 14px;border-right:1px solid rgba(200,169,110,0.09)">
      <button class="tab-btn active" id="tab-vault-btn" onclick="switchTab('vault',this)">ğŸ’ Vault</button>
      <button class="tab-btn" id="tab-trigger-btn" onclick="switchTab('trigger',this)">âš¡ Triggers</button>
      <button class="tab-btn" id="tab-embed-btn" onclick="switchTab('embed',this)">ğŸ”— Embed</button>
      <button class="tab-btn" id="tab-data-btn" onclick="switchTab('data',this)">ğŸ—„ï¸ Data</button>
      <button class="tab-btn" id="tab-demos-btn" onclick="switchTab('demos',this)">ğŸ“¨ Demos</button>
      <div id="sidebar-meta" style="display:none;margin-top:22px;padding:12px;background:rgba(200,169,110,0.05);border-radius:10px;font-size:10px;color:rgba(200,169,110,0.4);line-height:1.7">
        <div style="color:rgba(200,169,110,0.55);margin-bottom:2px">Last saved</div>
        <div id="meta-date"></div>
        <div id="meta-by"></div>
      </div>
    </div>

    <!-- CONTENT -->
    <div style="flex:1;padding:28px 32px;max-width:880px;overflow-y:auto">

      <!-- VAULT TAB -->
      <div id="tab-vault" class="tab-panel active">
        <h2 style="color:#c8a96e;margin-bottom:22px;font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700">Vault Configuration</h2>
        <div class="grid2">
          <div>
            <div style="margin-bottom:18px"><label class="label">Vault Title</label><input class="input" id="f-vaultTitle" oninput="liveUpdate()"/></div>
            <div style="margin-bottom:18px"><label class="label">Message</label><textarea class="input" id="f-vaultMessage" rows="3" oninput="liveUpdate()" style="resize:vertical"></textarea></div>
            <div style="margin-bottom:18px"><label class="label">CTA Button Label</label><input class="input" id="f-rewardLabel" oninput="liveUpdate()"/></div>
            <div style="margin-bottom:18px"><label class="label">Reward URL</label><input class="input" id="f-rewardUrl" type="url" oninput="liveUpdate()"/></div>
            <div style="margin-bottom:18px"><label class="label">Chest Icon / Emoji</label><input class="input" id="f-chestIcon" oninput="liveUpdate()" style="font-size:22px"/></div>
            <div style="margin-bottom:18px">
              <label class="label">Theme</label>
              <div style="display:flex;gap:8px;flex-wrap:wrap" id="theme-btns">
                <button onclick="setTheme('brown-cream',this)" class="theme-btn" style="padding:8px 14px;border-radius:8px;cursor:pointer;border:2px solid rgba(200,169,110,0.2);background:transparent;color:rgba(200,169,110,0.5);font-size:12px;font-family:'Jost',sans-serif">Brown & Cream</button>
                <button onclick="setTheme('dark-gold',this)" class="theme-btn" style="padding:8px 14px;border-radius:8px;cursor:pointer;border:2px solid rgba(200,169,110,0.2);background:transparent;color:rgba(200,169,110,0.5);font-size:12px;font-family:'Jost',sans-serif">Dark & Gold</button>
                <button onclick="setTheme('light-minimal',this)" class="theme-btn" style="padding:8px 14px;border-radius:8px;cursor:pointer;border:2px solid rgba(200,169,110,0.2);background:transparent;color:rgba(200,169,110,0.5);font-size:12px;font-family:'Jost',sans-serif">Light Minimal</button>
              </div>
            </div>
            <div style="margin-bottom:18px">
              <label class="label">Glow Accent Color</label>
              <div style="display:flex;gap:10px;align-items:center">
                <input type="color" id="f-glowColor-picker" oninput="document.getElementById('f-glowColor').value=this.value;liveUpdate()"/>
                <input class="input" id="f-glowColor" style="width:120px" oninput="document.getElementById('f-glowColor-picker').value=this.value;liveUpdate()"/>
              </div>
            </div>
            <div style="margin-bottom:18px">
              <label style="display:flex;align-items:center;gap:10px;cursor:pointer">
                <input type="checkbox" id="f-confettiEnabled" onchange="liveUpdate()"/>
                <span style="font-size:13px;color:rgba(200,169,110,0.7)">Enable confetti on open</span>
              </label>
            </div>
            <div style="margin-bottom:18px">
              <label class="label">Particle Count (<span id="particle-val">40</span>)</label>
              <input type="range" min="10" max="80" id="f-particleCount" oninput="document.getElementById('particle-val').textContent=this.value;liveUpdate()"/>
            </div>
          </div>
          <div>
            <label class="label">Live Preview</label>
            <div id="vault-preview" style="border-radius:16px;padding:28px;display:flex;flex-direction:column;align-items:center;gap:14px;min-height:220px;position:relative;overflow:hidden"></div>
          </div>
        </div>
      </div>

      <!-- TRIGGER TAB -->
      <div id="tab-trigger" class="tab-panel">
        <h2 style="color:#c8a96e;margin-bottom:6px;font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700">Trigger Settings</h2>
        <p style="color:rgba(200,169,110,0.45);font-size:13px;margin-bottom:26px">Control when the vault appears to visitors</p>
        <div style="max-width:480px">
          <div style="margin-bottom:28px">
            <label class="label">Time Delay Before Reveal (seconds)</label>
            <div style="display:flex;align-items:center;gap:16px">
              <input type="range" min="0" max="60" id="f-triggerDelay" oninput="document.getElementById('delay-val').textContent=this.value+'s';liveUpdate()"/>
              <span id="delay-val" style="min-width:42px;text-align:center;font-size:20px;color:#c8a96e;font-weight:700">8s</span>
            </div>
          </div>
          <div style="margin-bottom:28px">
            <label class="label">Scroll Depth Trigger (%)</label>
            <div style="display:flex;align-items:center;gap:16px">
              <input type="range" min="10" max="100" id="f-triggerScrollDepth" oninput="document.getElementById('scroll-val').textContent=this.value+'%';liveUpdate()"/>
              <span id="scroll-val" style="min-width:42px;text-align:center;font-size:20px;color:#c8a96e;font-weight:700">80%</span>
            </div>
          </div>
          <div class="card">
            <div style="font-size:12px;color:#c8a96e;font-weight:600;margin-bottom:8px">Current Trigger Logic</div>
            <div style="font-size:13px;color:rgba(200,169,110,0.6);line-height:1.8">
              Show vault after <strong style="color:#c8a96e" id="trig-delay">8 seconds</strong> on page<br/>
              AND visitor has scrolled <strong style="color:#c8a96e" id="trig-scroll">80%</strong> down<br/>
              <span style="font-size:11px;opacity:0.6">(Both conditions must be met)</span>
            </div>
          </div>
        </div>
      </div>

      <!-- EMBED TAB -->
      <div id="tab-embed" class="tab-panel">
        <h2 style="color:#c8a96e;margin-bottom:6px;font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700">Embed Code</h2>
        <p style="color:rgba(200,169,110,0.45);font-size:13px;margin-bottom:26px">Paste before the closing &lt;/body&gt; tag on any site</p>
        <div style="margin-bottom:18px">
          <label class="label">Allowed Domain (optional)</label>
          <input class="input" id="f-embedDomain" placeholder="yourdomain.com" oninput="liveUpdate()"/>
        </div>
        <div style="position:relative">
          <pre id="embed-code" style="background:rgba(0,0,0,0.45);border-radius:12px;padding:20px;border:1px solid rgba(200,169,110,0.14);color:#c8a96e;font-size:12px;line-height:1.7;font-family:monospace"></pre>
          <button class="btn-ghost" onclick="copyEmbed()" style="position:absolute;top:12px;right:12px;font-size:11px;padding:5px 12px">Copy</button>
        </div>
        <div style="margin-top:18px;background:rgba(76,175,125,0.07);border:1px solid rgba(76,175,125,0.18);border-radius:12px;padding:16px">
          <div style="font-size:12px;color:#4caf7d;font-weight:600;margin-bottom:6px">âœ“ Supabase Powered</div>
          <div style="font-size:12px;color:rgba(76,175,125,0.65);line-height:1.7">Settings are stored in your Supabase database. Any admin update from any device reflects instantly on all live embeds. No cache clearing. No re-pasting. Zero downtime.</div>
        </div>
      </div>

      <!-- DATA TAB -->
      <div id="tab-data" class="tab-panel">
        <h2 style="color:#c8a96e;margin-bottom:22px;font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700">Data & Storage</h2>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:28px">
          <div class="card"><div style="font-size:26px;margin-bottom:10px">ğŸ—„ï¸</div><div style="font-size:10px;color:rgba(200,169,110,0.4);text-transform:uppercase;letter-spacing:1px">Storage Engine</div><div style="font-size:15px;font-weight:700;color:#4caf7d;margin-top:4px">Supabase PostgreSQL</div><div style="font-size:11px;color:rgba(200,169,110,0.4);margin-top:3px">Real database Â· Cross-device sync</div></div>
          <div class="card"><div style="font-size:26px;margin-bottom:10px">ğŸ”</div><div style="font-size:10px;color:rgba(200,169,110,0.4);text-transform:uppercase;letter-spacing:1px">Session Status</div><div style="font-size:15px;font-weight:700;color:#c8a96e;margin-top:4px">Active & Secure</div><div id="data-email" style="font-size:11px;color:rgba(200,169,110,0.4);margin-top:3px"></div></div>
          <div class="card"><div style="font-size:26px;margin-bottom:10px">ğŸ’¾</div><div style="font-size:10px;color:rgba(200,169,110,0.4);text-transform:uppercase;letter-spacing:1px">Auto-Backup</div><div id="data-backup" style="font-size:15px;font-weight:700;color:#4caf7d;margin-top:4px">Active</div><div style="font-size:11px;color:rgba(200,169,110,0.4);margin-top:3px">Previous state saved before each update</div></div>
          <div class="card"><div style="font-size:26px;margin-bottom:10px">â±ï¸</div><div style="font-size:10px;color:rgba(200,169,110,0.4);text-transform:uppercase;letter-spacing:1px">Last Updated</div><div id="data-updated" style="font-size:15px;font-weight:700;color:rgba(200,169,110,0.7);margin-top:4px">â€”</div><div id="data-updatedby" style="font-size:11px;color:rgba(200,169,110,0.4);margin-top:3px">â€”</div></div>
        </div>
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <button class="btn-ghost" onclick="restoreBackup()">â†© Restore Previous Backup</button>
          <button class="btn-gold" onclick="forceSave()">Force Save Now</button>
        </div>
        <div class="card" style="margin-top:28px">
          <div style="font-size:13px;color:#c8a96e;font-weight:600;margin-bottom:10px">Phase 2: Enterprise Features</div>
          <div style="font-size:12px;color:rgba(200,169,110,0.5);line-height:1.9">
            â€¢ Supabase Vault for API key storage<br/>
            â€¢ OAuth authentication (Google login, magic links)<br/>
            â€¢ Stripe webhook auto-provisioning<br/>
            â€¢ CDN-hosted loader script with version control<br/>
            â€¢ Analytics dashboard with per-domain conversion tracking
          </div>
        </div>
      </div>

      <!-- DEMOS TAB -->
      <div id="tab-demos" class="tab-panel">
        <h2 style="color:#c8a96e;margin-bottom:6px;font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700">Send Demo Invites</h2>
        <p style="color:rgba(200,169,110,0.45);font-size:13px;margin-bottom:26px">Invite prospects to experience Diamond Finderâ„¢ firsthand â€” personalized, tracked, and conversion-ready</p>

        <!-- Single invite -->
        <div class="card" style="margin-bottom:22px">
          <div style="font-size:13px;font-weight:700;color:#c8a96e;margin-bottom:16px">âœ‰ï¸ Send Individual Invite</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px">
            <div>
              <label class="label">Recipient Name</label>
              <input class="input" id="invite-name" placeholder="First name"/>
            </div>
            <div>
              <label class="label">Recipient Email</label>
              <input class="input" id="invite-email" type="email" placeholder="their@email.com"/>
            </div>
          </div>
          <div style="margin-bottom:14px">
            <label class="label">Personal Note (optional)</label>
            <textarea class="input" id="invite-note" rows="2" placeholder="e.g. Thought you'd love this for your siteâ€¦" style="resize:vertical"></textarea>
          </div>
          <div style="display:flex;align-items:center;gap:12px">
            <button class="btn-gold" onclick="sendInvite()" id="send-invite-btn" style="width:auto;padding:11px 28px">Send Invite â†’</button>
            <span id="invite-status" style="font-size:13px;color:rgba(200,169,110,0.5)"></span>
          </div>
        </div>

        <!-- Bulk invite -->
        <div class="card" style="margin-bottom:22px">
          <div style="font-size:13px;font-weight:700;color:#c8a96e;margin-bottom:16px">ğŸ“‹ Bulk Invite (CSV)</div>
          <p style="font-size:12px;color:rgba(200,169,110,0.45);margin-bottom:14px">One email per line, or <code style="background:rgba(200,169,110,0.1);padding:1px 6px;border-radius:4px">Name,Email</code> per line</p>
          <textarea class="input" id="bulk-emails" rows="5" placeholder="Sarah,sarah@example.com&#10;John,john@example.com&#10;orjust@email.com" style="resize:vertical;font-family:monospace;font-size:13px"></textarea>
          <div style="display:flex;align-items:center;gap:12px;margin-top:14px">
            <button class="btn-gold" onclick="sendBulkInvites()" id="bulk-btn" style="width:auto;padding:11px 28px">Send All â†’</button>
            <span id="bulk-status" style="font-size:13px;color:rgba(200,169,110,0.5)"></span>
          </div>
        </div>

        <!-- Sent log -->
        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px">
            <div style="font-size:13px;font-weight:700;color:#c8a96e">ğŸ“Š Invite History</div>
            <button class="btn-ghost" onclick="loadInviteLog()" style="font-size:11px;padding:5px 12px">â†º Refresh</button>
          </div>
          <div id="invite-log" style="font-size:13px;color:rgba(200,169,110,0.5)">
            <div style="text-align:center;padding:20px;opacity:0.5">Loading invite historyâ€¦</div>
          </div>
        </div>
      </div>

    </div><!-- end content -->
  </div><!-- end flex -->
</div><!-- end dashboard -->

<script>
// â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SUPABASE_URL = 'https://jajtyudbkyrqklbnaggm.supabase.co';
const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImphanR5dWRia3lycWtsYm5hZ2dtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwMTU5MzksImV4cCI6MjA4NjU5MTkzOX0.CIXkT6tBbjB5L-1FYECN9UzPLNJTg33hSImB7OONkgs';

const SUPER_ADMINS = [
  'kendryah@highticketpurpose.com',
  'support@highticketpurpose.com',
  'support@elvt.social',
  'denahornsby@yahoo.com'
];
const ADMIN_CREDS = {
  'kendryah@highticketpurpose.com': 'HTPleader!!!',
  'support@highticketpurpose.com':  'HTPSupport1!',
  'support@elvt.social':            'ELVT2024!',
  'denahornsby@yahoo.com':          'Dena2024!'
};
const PW_HINT_EMAIL = 'kendryah@highticketpurpose.com';

const THEMES = {
  'brown-cream':  { bg:'linear-gradient(135deg,#2c1a0e,#4a2c17)', card:'rgba(255,248,235,0.97)', accent:'#c8a96e', text:'#2c1a0e' },
  'dark-gold':    { bg:'linear-gradient(135deg,#0a0a0a,#1a1a2e)', card:'rgba(20,20,30,0.97)',    accent:'#ffd700', text:'#f0e6c8' },
  'light-minimal':{ bg:'linear-gradient(135deg,#f8f6f2,#ede9e3)', card:'rgba(255,255,255,0.98)', accent:'#8b6f4e', text:'#2c2318' }
};

const DEFAULT = {
  vaultTitle:'You Found a Diamond!',
  vaultMessage:"As a thank-you for exploring, here's an exclusive gift just for you.",
  rewardLabel:'Claim Your Exclusive Gift',
  rewardUrl:'https://highticketpurpose.com',
  chestIcon:'ğŸ’',
  theme:'brown-cream',
  triggerDelay:8,
  triggerScrollDepth:80,
  confettiEnabled:true,
  glowColor:'#c8a96e',
  particleCount:40,
  embedDomain:'',
  updatedAt:null,
  updatedBy:null
};

// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentEmail = '';
let settings = {...DEFAULT};
let backup = null;
let saveTimer = null;

// â”€â”€â”€ SUPABASE API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function sbFetch(method, body) {
  const res = await fetch(SUPABASE_URL + '/rest/v1/diamond_settings', {
    method,
    headers: {
      'apikey': SUPABASE_ANON,
      'Authorization': 'Bearer ' + SUPABASE_ANON,
      'Content-Type': 'application/json',
      'Prefer': method === 'POST' ? 'resolution=merge-duplicates,return=representation' : 'return=representation'
    },
    body: body ? JSON.stringify(body) : undefined
  });
  if (!res.ok) { const e = await res.text(); throw new Error(e); }
  return res.status === 204 ? null : res.json();
}

async function loadFromDB(email) {
  const res = await fetch(SUPABASE_URL + '/rest/v1/diamond_settings?admin_email=eq.' + encodeURIComponent(email) + '&select=*', {
    headers: { 'apikey': SUPABASE_ANON, 'Authorization': 'Bearer ' + SUPABASE_ANON }
  });
  const data = await res.json();
  return data && data.length > 0 ? data[0] : null;
}

async function saveToDB(email, s, bk) {
  await sbFetch('POST', {
    admin_email: email,
    settings: s,
    backup: bk,
    updated_at: new Date().toISOString(),
    updated_by: email
  });
}

// â”€â”€â”€ AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('login-email').addEventListener('input', function() {
  const hint = document.getElementById('pw-hint');
  hint.style.display = this.value.trim().toLowerCase() === PW_HINT_EMAIL ? 'inline' : 'none';
});

async function doLogin() {
  const email = document.getElementById('login-email').value.trim().toLowerCase();
  const pass  = document.getElementById('login-pass').value;
  const err   = document.getElementById('login-error');
  err.style.display = 'none';

  if (!SUPER_ADMINS.includes(email)) { showErr('Email not authorized.'); return; }
  if (ADMIN_CREDS[email] !== pass)   { showErr('Invalid password.'); return; }

  currentEmail = email;
  localStorage.setItem('df_session', email);

  setSaveStatus('saving', 'âŸ³ Loading your settingsâ€¦');
  try {
    const row = await loadFromDB(email);
    if (row) {
      settings = Object.assign({}, DEFAULT, row.settings, {updatedAt: row.updated_at, updatedBy: row.updated_by});
      backup = row.backup;
    }
  } catch(e) { console.warn('Load failed:', e); }

  showDashboard();
}

function showErr(msg) {
  const e = document.getElementById('login-error');
  e.textContent = msg; e.style.display = 'block';
}

function doLogout() {
  localStorage.removeItem('df_session');
  currentEmail = '';
  settings = Object.assign({}, DEFAULT);
  document.getElementById('dashboard').style.display = 'none';
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('login-email').value = '';
  document.getElementById('login-pass').value = '';
}

// â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showDashboard() {
  document.getElementById('loading-screen').style.display = 'none';
  document.getElementById('login-screen').style.display = 'none';
  const dash = document.getElementById('dashboard');
  dash.style.display = 'flex';
  document.getElementById('nav-email').textContent = currentEmail;
  document.getElementById('data-email').textContent = currentEmail;
  populateFields();
  renderPreview();
  updateEmbedCode();
  setSaveStatus('saved', 'âœ“ Settings loaded');
  setTimeout(function(){ setSaveStatus('idle'); }, 2500);
}

function populateFields() {
  const s = settings;
  document.getElementById('f-vaultTitle').value        = s.vaultTitle;
  document.getElementById('f-vaultMessage').value      = s.vaultMessage;
  document.getElementById('f-rewardLabel').value       = s.rewardLabel;
  document.getElementById('f-rewardUrl').value         = s.rewardUrl;
  document.getElementById('f-chestIcon').value         = s.chestIcon;
  document.getElementById('f-glowColor').value         = s.glowColor;
  document.getElementById('f-glowColor-picker').value  = s.glowColor;
  document.getElementById('f-confettiEnabled').checked = s.confettiEnabled;
  document.getElementById('f-particleCount').value     = s.particleCount;
  document.getElementById('f-triggerDelay').value      = s.triggerDelay;
  document.getElementById('f-triggerScrollDepth').value= s.triggerScrollDepth;
  document.getElementById('f-embedDomain').value       = s.embedDomain || '';
  document.getElementById('particle-val').textContent  = s.particleCount;
  document.getElementById('delay-val').textContent     = s.triggerDelay + 's';
  document.getElementById('scroll-val').textContent    = s.triggerScrollDepth + '%';
  document.getElementById('trig-delay').textContent    = s.triggerDelay + ' seconds';
  document.getElementById('trig-scroll').textContent   = s.triggerScrollDepth + '%';

  document.querySelectorAll('.theme-btn').forEach(function(btn) {
    const active = (btn.textContent.includes('Brown') && s.theme === 'brown-cream') ||
      (btn.textContent.includes('Dark') && s.theme === 'dark-gold') ||
      (btn.textContent.includes('Light') && s.theme === 'light-minimal');
    btn.style.border     = active ? '2px solid #c8a96e' : '2px solid rgba(200,169,110,0.2)';
    btn.style.background = active ? 'rgba(200,169,110,0.15)' : 'transparent';
    btn.style.color      = active ? '#c8a96e' : 'rgba(200,169,110,0.5)';
  });

  if (s.updatedAt) {
    const d = new Date(s.updatedAt);
    document.getElementById('sidebar-meta').style.display = 'block';
    document.getElementById('meta-date').textContent = d.toLocaleDateString() + ' ' + d.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
    document.getElementById('meta-by').textContent   = (s.updatedBy||'').split('@')[0];
    document.getElementById('data-updated').textContent   = d.toLocaleDateString();
    document.getElementById('data-updatedby').textContent = s.updatedBy || 'â€”';
  }
}

function liveUpdate() {
  settings.vaultTitle         = document.getElementById('f-vaultTitle').value;
  settings.vaultMessage       = document.getElementById('f-vaultMessage').value;
  settings.rewardLabel        = document.getElementById('f-rewardLabel').value;
  settings.rewardUrl          = document.getElementById('f-rewardUrl').value;
  settings.chestIcon          = document.getElementById('f-chestIcon').value;
  settings.glowColor          = document.getElementById('f-glowColor').value;
  settings.confettiEnabled    = document.getElementById('f-confettiEnabled').checked;
  settings.particleCount      = +document.getElementById('f-particleCount').value;
  settings.triggerDelay       = +document.getElementById('f-triggerDelay').value;
  settings.triggerScrollDepth = +document.getElementById('f-triggerScrollDepth').value;
  settings.embedDomain        = document.getElementById('f-embedDomain').value;

  document.getElementById('trig-delay').textContent  = settings.triggerDelay + ' seconds';
  document.getElementById('trig-scroll').textContent = settings.triggerScrollDepth + '%';

  renderPreview();
  updateEmbedCode();
  debounceSave();
}

function setTheme(t, btn) {
  settings.theme = t;
  document.querySelectorAll('.theme-btn').forEach(function(b) {
    b.style.border   = '2px solid rgba(200,169,110,0.2)';
    b.style.background = 'transparent';
    b.style.color    = 'rgba(200,169,110,0.5)';
  });
  btn.style.border   = '2px solid #c8a96e';
  btn.style.background = 'rgba(200,169,110,0.15)';
  btn.style.color    = '#c8a96e';
  renderPreview();
  debounceSave();
}

// â”€â”€â”€ PREVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderPreview() {
  const s = settings;
  const t = THEMES[s.theme] || THEMES['brown-cream'];
  const p = document.getElementById('vault-preview');
  p.style.background = t.bg;
  p.innerHTML = '<div style="font-size:48px">' + s.chestIcon + '</div>' +
    '<div style="background:' + t.card + ';border-radius:12px;padding:20px 26px;text-align:center;max-width:280px;box-shadow:0 8px 32px rgba(0,0,0,0.28)">' +
    '<div style="font-family:\'Cormorant Garamond\',serif;font-size:18px;font-weight:700;color:' + t.text + ';margin-bottom:8px">' + s.vaultTitle + '</div>' +
    '<div style="font-size:12px;color:' + t.text + ';opacity:0.7;margin-bottom:14px">' + s.vaultMessage + '</div>' +
    '<button style="background:' + t.accent + ';color:#fff;border:none;border-radius:8px;padding:8px 20px;font-size:12px;font-weight:600;cursor:pointer">' + s.rewardLabel + '</button>' +
    '</div>';
}

// â”€â”€â”€ EMBED CODE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateEmbedCode() {
  const code = '<!-- Diamond Finderâ„¢ Embed -->\n<script>\n  (function(){\n    var df = document.createElement(\'script\');\n    df.src = \'https://kendryah-htp.github.io/diamond-finder/loader.js\';\n    df.dataset.admin  = \'' + currentEmail + '\';\n    df.dataset.delay  = \'' + settings.triggerDelay + '\';\n    df.dataset.scroll = \'' + settings.triggerScrollDepth + '\';\n    df.async = true;\n    document.head.appendChild(df);\n  })();\n<\/script>';
  document.getElementById('embed-code').textContent = code;
}

function copyEmbed() {
  navigator.clipboard.writeText(document.getElementById('embed-code').textContent);
  const btn = event.target;
  btn.textContent = 'âœ“ Copied!';
  setTimeout(function(){ btn.textContent = 'Copy'; }, 2000);
}

// â”€â”€â”€ SAVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function debounceSave() {
  clearTimeout(saveTimer);
  saveTimer = setTimeout(function(){ forceSave(); }, 900);
}

async function forceSave() {
  setSaveStatus('saving', 'âŸ³ Savingâ€¦');
  try {
    const toSave = Object.assign({}, settings, {updatedAt: new Date().toISOString(), updatedBy: currentEmail});
    await saveToDB(currentEmail, toSave, settings);
    settings = toSave;
    backup = Object.assign({}, settings);
    setSaveStatus('saved', 'âœ“ Saved & synced');
    populateFields();
    setTimeout(function(){ setSaveStatus('idle'); }, 3000);
  } catch(e) {
    setSaveStatus('error', 'âœ— Save failed');
    console.error(e);
  }
}

async function restoreBackup() {
  if (!backup) { alert('No backup available yet.'); return; }
  settings = Object.assign({}, DEFAULT, backup);
  populateFields();
  renderPreview();
  updateEmbedCode();
  await forceSave();
}

function setSaveStatus(type, text) {
  const el = document.getElementById('save-status');
  const colors = { saving:'#c8a96e', saved:'#4caf7d', error:'#e05252', idle:'transparent' };
  el.textContent = text || '';
  el.style.color   = colors[type] || 'transparent';
  el.style.opacity = type === 'idle' ? '0' : '1';
}

// â”€â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(id, btn) {
  document.querySelectorAll('.tab-panel').forEach(function(p){ p.classList.remove('active'); });
  document.querySelectorAll('.tab-btn').forEach(function(b){ b.classList.remove('active'); });
  document.getElementById('tab-' + id).classList.add('active');
  btn.classList.add('active');
  if (id === 'demos') loadInviteLog();
}

// â”€â”€â”€ DEMOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var DEMO_URL  = 'https://kendryah-htp.github.io/diamond-finder/demo.html';
var RESEND_KEY= 're_AjeZMouE_42a2JX1iAjSjjSuqSWVtbxL6';
var FROM_EMAIL= 're@elvt.social';

async function sendInvite() {
  var name  = document.getElementById('invite-name').value.trim();
  var email = document.getElementById('invite-email').value.trim().toLowerCase();
  var note  = document.getElementById('invite-note').value.trim();
  var status= document.getElementById('invite-status');
  var btn   = document.getElementById('send-invite-btn');

  if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { status.textContent='âš  Valid email required'; status.style.color='#e05252'; return; }

  btn.disabled=true; btn.textContent='Sendingâ€¦'; status.textContent=''; status.style.color='rgba(200,169,110,0.5)';

  try {
    await sendDemoEmail(name || email.split('@')[0], email, note);
    await logInvite(name || email.split('@')[0], email);
    status.textContent='âœ“ Invite sent!'; status.style.color='#4caf7d';
    document.getElementById('invite-name').value='';
    document.getElementById('invite-email').value='';
    document.getElementById('invite-note').value='';
    loadInviteLog();
  } catch(e) {
    status.textContent='âœ— Failed â€” check email config'; status.style.color='#e05252';
    console.error(e);
  }
  btn.disabled=false; btn.textContent='Send Invite â†’';
}

async function sendBulkInvites() {
  var raw   = document.getElementById('bulk-emails').value.trim();
  var status= document.getElementById('bulk-status');
  var btn   = document.getElementById('bulk-btn');
  if (!raw) { status.textContent='âš  Enter at least one email'; status.style.color='#e05252'; return; }

  var lines = raw.split('\n').map(function(l){ return l.trim(); }).filter(Boolean);
  var parsed = lines.map(function(l){
    var parts = l.split(',');
    return parts.length>=2
      ? { name: parts[0].trim(), email: parts[1].trim().toLowerCase() }
      : { name: l.split('@')[0], email: l.toLowerCase() };
  }).filter(function(r){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.email); });

  if (!parsed.length) { status.textContent='âš  No valid emails found'; status.style.color='#e05252'; return; }

  btn.disabled=true; status.style.color='rgba(200,169,110,0.6)';
  var sent=0, failed=0;
  for (var i=0; i<parsed.length; i++) {
    status.textContent='Sending ' + (i+1) + '/' + parsed.length + 'â€¦';
    try {
      await sendDemoEmail(parsed[i].name, parsed[i].email, '');
      await logInvite(parsed[i].name, parsed[i].email);
      sent++;
    } catch(e) { failed++; }
    await new Promise(function(r){ setTimeout(r, 350); }); // rate limit buffer
  }
  status.textContent='âœ“ ' + sent + ' sent' + (failed?' Â· âœ— '+failed+' failed':''); status.style.color= failed?'#e0b452':'#4caf7d';
  document.getElementById('bulk-emails').value='';
  loadInviteLog();
  btn.disabled=false;
}

async function sendDemoEmail(name, email, note) {
  var firstName = name.split(' ')[0];
  var html = '\
<!DOCTYPE html><html><head><meta charset="UTF-8"/></head><body style="margin:0;padding:0;background:#0f0a07;font-family:\'Jost\',Arial,sans-serif">\
<div style="max-width:520px;margin:0 auto;padding:28px 16px">\
  <div style="background:linear-gradient(135deg,#1e1208,#2c1a0e);border:1px solid rgba(200,169,110,0.25);border-radius:20px;overflow:hidden">\
    <div style="padding:32px 36px;text-align:center;border-bottom:1px solid rgba(200,169,110,0.12)">\
      <div style="font-size:44px;margin-bottom:10px">ğŸ’</div>\
      <div style="color:#c8a96e;font-size:22px;font-weight:700;letter-spacing:2px;font-family:Georgia,serif">Diamond Finderâ„¢</div>\
      <div style="color:rgba(200,169,110,0.45);font-size:11px;margin-top:4px;letter-spacing:2px;text-transform:uppercase">Exclusive Demo Invitation</div>\
    </div>\
    <div style="padding:28px 36px">\
      <p style="color:#f5e6c8;font-size:16px;margin-bottom:6px">Hi <strong style="color:#c8a96e">' + firstName + '</strong>,</p>\
      <p style="color:rgba(245,230,200,0.75);font-size:14px;line-height:1.8;margin-bottom:18px">' + (note || 'You\'ve been personally invited to explore Diamond Finderâ„¢ â€” the hidden vault that turns your best website visitors into loyal fans.') + '</p>\
      <p style="color:rgba(245,230,200,0.75);font-size:14px;line-height:1.8;margin-bottom:22px">Inside your private demo you\'ll configure a real vault, set trigger rules, and see exactly what your visitors experience when they discover it.</p>\
      <div style="text-align:center;margin-bottom:22px">\
        <a href="' + DEMO_URL + '" style="display:inline-block;background:linear-gradient(135deg,#c8a96e,#a07840);color:#fff;text-decoration:none;padding:14px 32px;border-radius:12px;font-size:15px;font-weight:700;letter-spacing:1px">ENTER YOUR DEMO â†’</a>\
      </div>\
      <div style="background:rgba(200,169,110,0.06);border:1px solid rgba(200,169,110,0.15);border-radius:10px;padding:14px;margin-bottom:18px">\
        <div style="font-size:11px;color:rgba(200,169,110,0.5);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px">What\'s inside your demo</div>\
        <div style="font-size:13px;color:rgba(245,230,200,0.65);line-height:2">ğŸ’ &nbsp;Vault configurator with live preview<br/>âš¡ &nbsp;Trigger rule builder<br/>ğŸŒ &nbsp;Scroll the live site to find the vault<br/>ğŸ”— &nbsp;Your embed code â€” ready to install</div>\
      </div>\
    </div>\
    <div style="padding:16px 36px;border-top:1px solid rgba(200,169,110,0.1);text-align:center">\
      <div style="font-size:11px;color:rgba(200,169,110,0.3)">Diamond Finderâ„¢ by <a href="https://highticketpurpose.com" style="color:rgba(200,169,110,0.4);text-decoration:none">ELVT Social</a> Â· <a href="https://kendryah-htp.github.io/diamond-finder/#pricing" style="color:rgba(200,169,110,0.4);text-decoration:none">View Pricing</a></div>\
    </div>\
  </div>\
</div></body></html>';

  var res = await fetch('https://api.resend.com/emails', {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ' + RESEND_KEY, 'Content-Type': 'application/json' },
    body: JSON.stringify({
      from: 'Diamond Finderâ„¢ <' + FROM_EMAIL + '>',
      to: [email],
      subject: 'ğŸ’ ' + firstName + ', your Diamond Finderâ„¢ demo is ready',
      html: html
    })
  });
  if (!res.ok) { var e = await res.text(); throw new Error(e); }
  return res.json();
}

async function logInvite(name, email) {
  await fetch(SB_URL + '/rest/v1/demo_invites', {
    method: 'POST',
    headers: {
      'apikey': SB_ANON,
      'Authorization': 'Bearer ' + SB_ANON,
      'Content-Type': 'application/json',
      'Prefer': 'resolution=merge-duplicates'
    },
    body: JSON.stringify({ name: name, email: email, sent_by: currentEmail, sent_at: new Date().toISOString() })
  });
}

async function loadInviteLog() {
  var log = document.getElementById('invite-log');
  log.innerHTML = '<div style="text-align:center;padding:12px;opacity:0.5">Loadingâ€¦</div>';
  try {
    var res = await fetch(SB_URL + '/rest/v1/demo_invites?order=sent_at.desc&limit=50&select=*', {
      headers: { 'apikey': SB_ANON, 'Authorization': 'Bearer ' + SB_ANON }
    });
    var rows = await res.json();
    if (!rows || !rows.length) { log.innerHTML='<div style="text-align:center;padding:20px;opacity:0.4">No invites sent yet</div>'; return; }
    var html = '<table style="width:100%;border-collapse:collapse">' +
      '<tr style="font-size:10px;color:rgba(200,169,110,0.4);text-transform:uppercase;letter-spacing:1px;border-bottom:1px solid rgba(200,169,110,0.1)">' +
      '<td style="padding:6px 10px">Name</td><td style="padding:6px 10px">Email</td><td style="padding:6px 10px">Sent By</td><td style="padding:6px 10px">Date</td>' +
      '</tr>';
    rows.forEach(function(r,i){
      var d = new Date(r.sent_at);
      html += '<tr style="border-bottom:1px solid rgba(200,169,110,0.06);' + (i%2===0?'background:rgba(200,169,110,0.02)':'') + '">' +
        '<td style="padding:9px 10px;font-size:13px;color:#f5e6c8">' + (r.name||'â€”') + '</td>' +
        '<td style="padding:9px 10px;font-size:12px;color:rgba(200,169,110,0.6)">' + r.email + '</td>' +
        '<td style="padding:9px 10px;font-size:11px;color:rgba(200,169,110,0.4)">' + (r.sent_by||'').split('@')[0] + '</td>' +
        '<td style="padding:9px 10px;font-size:11px;color:rgba(200,169,110,0.4)">' + d.toLocaleDateString() + ' ' + d.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}) + '</td>' +
        '</tr>';
    });
    html += '</table>';
    log.innerHTML = html;
  } catch(e) {
    log.innerHTML = '<div style="color:#e05252;font-size:13px;padding:12px">Failed to load invite log</div>';
  }
}


window.addEventListener('load', function() {
  var session = localStorage.getItem('df_session');
  if (session && SUPER_ADMINS.indexOf(session) > -1) {
    currentEmail = session;
    loadFromDB(session).then(function(row) {
      if (row) {
        settings = Object.assign({}, DEFAULT, row.settings, {updatedAt: row.updated_at, updatedBy: row.updated_by});
        backup = row.backup;
      }
      showDashboard();
    }).catch(function(e) {
      console.warn('Load error:', e);
      showDashboard();
    });
  } else {
    document.getElementById('loading-screen').style.display = 'none';
    document.getElementById('login-screen').style.display = 'flex';
  }
});
</script>
</body>
</html>
